!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","rxjs","rxjs/operators"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).iQ={},e.rxjs,e.rxjs.operators)}(this,(function(e,t,n){"use strict";const r=Array.isArray;function i(e){return null==e}function s(e){return"function"==typeof e}function o(e){return"string"==typeof e}function l(e){return!0===e||!1===e}function c(e){const[t,n]=(e=>e?[!o(e)&&e instanceof Element&&e,o(e)&&e]:[null,null])(e);if(t)return t;if(!window||!window.document)throw new Error("Atom-iQ RvDOM Renderer Error: Element/Document is undefined");return n?window.document.querySelector(n):window.document.body}const a=["svg","animate","animateTransform","circle","clipPath","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","foreignObject","g","image","line","linearGradient","marker","mask","metadata","path","pattern","polygon","polyline","radialGradient","rect","stop","switch","symbol","text","textPath","tspan","use","view"],d="_Fragment",h=(e,t)=>{const n=e.split("."),r=t.split(".");if(n.length>r.length)for(let e=0;e<r.length;e++){const t=Number(n[e]),i=Number(r[e]);if(t!==i)return t-i}else for(let e=0;e<n.length;e++){const t=Number(n[e]),i=Number(r[e]);if(t!==i)return t-i}return 0};function u(e){return!(!e||!e.type)}function f(e,t,n,c,a,h){return f=>{if(console.log("Child Type Switch: ",f),i(f)||l(f))return e&&e();if(function(e){const t=typeof e;return"string"===t||"number"===t}(f))return t(f);if(r(f))return console.log("IS ARRAY"),n(f);if(u(f)){if(m=f,Boolean(s(m.type)&&m._component))return c(f);if(function(e){return o(e.type)&&e.type===d}(f))return a(f);if(function(e){return o(e.type)&&e.type!==d}(f))return h(f)}var m}}function m(e,t,n){return(r,i)=>(console.log("Render type switch, child index: ",r),i.has(r)?(console.log("has one"),e(i.get(r))):i.hasFragment(r)?(console.log("has many"),t(i.getFragment(r))):(console.log("has nothing"),void 0!==n&&n()))}function g(e){return document.createTextNode(String(e))}function y(e,t){return e.appendChild(t)}function p(e,t,n){return e.insertBefore(t,n)}const b=(e,n,r)=>{Object.entries(e).forEach(([e,i])=>{const s=(e.includes("-"),e);t.isObservable(i)?r.add(i.subscribe(e=>{n.style[s]=e})):n.style[s]=i})},x=(e,t)=>(e,n)=>{const r="class"===e?"className":e;"className"===r?i(n)?t.className="":t.className=String(n):i(n)?t.removeAttribute(r):l(n)?n?t.setAttribute(r,r):t.removeAttribute(r):t.setAttribute(r,String(n))};function C(e,r){const l=new t.Subscription;var c,a,d,h;return e.props&&Object.entries(e.props).forEach((c=((e,n,r)=>(e,s)=>{t.isObservable(s)?r.add(s.subscribe(e=>{o(e)?n.setAttribute("style",e):i(e)?n.removeAttribute("style"):b(e,n,r)})):o(s)?n.setAttribute("style",s):i(s)||b(s,n,r)})(0,r,l),a=((e,r,i)=>(s,o)=>{if((e=>e.startsWith("on"))(s))if(((e,t)=>e.endsWith("$"))(s)){const l=s.substr(0,s.length-1),c=l.slice(2).toLocaleLowerCase(),a=n.map(e=>Object.assign({element:r},e))(t.fromEvent(r,c));i.add(o(a).subscribe(t=>{e.props[l]&&e.props[l](t)}))}else{if(e.props[s+"$"])return;const l=s.slice(2).toLocaleLowerCase(),c=n.map(e=>Object.assign({element:r},e))(t.fromEvent(r,l));i.add(c.subscribe(e=>o(e)))}})(e,r,l),d=((e,t,n)=>(e,r)=>{n.add(r.subscribe(n=>{x(0,t)(e,n)}))})(0,r,l),h=x(0,r),([e,n])=>{if(!(e=>"children"===e||"key"===e||"ref"===e)(e))return((e,t)=>"style"===e)(e)?c(e,n):s(n)?a(e,n):t.isObservable(n)?d(e,n):h(e,n)})),l}function v(e){e.subscription&&e.subscription.unsubscribe()}const k=e=>({props:null,type:"_Fragment",children:e}),F=(e,t=!1)=>(n,r)=>{const i=e.get(r)||e.getFragment(r);return i.fragmentChildIndexes?n.concat(i.fragmentChildIndexes.reduce(F(e,t),[])):n.concat(t?i.index:i)};function E(e,t,n,r,i){if(i.empty())y(r,t);else if(i.hasOneChild()){const e=i.getFirstIndex();if(parseInt(n)>parseInt(e))y(r,t);else{p(r,t,i.getFirstChild().element)}}else{const{isFirst:e,isLast:s,nextSibling:o,firstChild:l}=i.getPositionInfoForNewChild(n);e?p(r,t,l.element):s?y(r,t):p(r,t,o.element)}return e({index:n,element:t})}function S(e,t,n,r,i){const s=i.get(n);if(o=r,l=t,c=s.element,o.replaceChild(l,c))return e({index:n,element:t});var o,l,c}function w(e,t,n,r){const i=r.get(t);if(s=n,o=i.element,s.removeChild(o))return e(i);var s,o}class O{constructor(){this[Symbol.iterator]=()=>this.toEntriesArray()[Symbol.iterator](),this.indexes=[],this.children={},this.fragmentIndexes=[],this.fragmentChildren={},this.has=e=>!!this.children[e],this.get=e=>this.children[e],this.hasFragment=e=>!!this.fragmentChildren[e],this.getFragment=e=>this.fragmentChildren[e],this.setFnFactory=(e,t=!1)=>(n,r)=>{try{const i="add"===e,s=t?!!this.fragmentChildren[n]:!!this.children[n];return!!(i?!s:s)&&(t?(i&&(this.fragmentIndexes=this.fragmentIndexes.concat(n)),this.fragmentChildren[n]=r):(i&&(this.indexes=this.indexes.concat(n)),this.children[n]=r),!0)}catch(e){return!1}},this.add=this.setFnFactory("add"),this.replace=this.setFnFactory("replace"),this.addFragment=this.setFnFactory("add",!0),this.replaceFragment=this.setFnFactory("replace",!0),this.createEmptyFragment=e=>this.addFragment(e,{index:e,element:d,fragmentChildIndexes:[],fragmentChildKeys:{},fragmentChildrenLength:0}),this.remove=e=>this.has(e)&&this.delete(e),this.removeFragment=e=>this.hasFragment(e)&&this.delete(e,!0),this.size=()=>this.indexes.length,this.empty=()=>0===this.indexes.length,this.getAll=()=>this.indexes.map(e=>this.children[e]),this.getKeys=()=>this.indexes,this.removeAll=()=>(this.indexes=[],this.children={},!0),this.toEntriesArray=()=>this.indexes.map(this.mapToEntry),this.getFirstIndex=()=>this.indexes[0],this.getFirstChild=()=>this.children[this.indexes[0]],this.hasOneChild=()=>1===this.indexes.length,this.delete=(e,t=!1)=>{try{return t?(this.fragmentIndexes=this.fragmentIndexes.filter(t=>t!==e),delete this.fragmentChildren[e]):(this.indexes=this.indexes.filter(t=>t!==e),delete this.children[e]),!0}catch(e){return!1}},this.mapToEntry=e=>[e,this.children[e]],this.getChildOrNull=(e,t)=>e?this.children[t()]:null,this.getPositionInfoForNewChild=e=>{const t=O.sortIndexes(this.indexes.concat(e)),n=t.indexOf(e),r=function(e){return 0===e}(n),i=function(e,t){return e===t.length-1}(n,t),s=this.getChildOrNull(!r,()=>t[0]),o=this.getChildOrNull(!r,()=>t[n-1]),l=this.getChildOrNull(!i,()=>t[n+1]);return{indexInArray:n,allSortedIndexes:t,isFirst:r,isLast:i,previousSibling:o,nextSibling:l,firstChild:s}}}get[Symbol.toStringTag](){return JSON.stringify(this.indexes)}}O.sortIndexes=e=>(e=>e.sort(h))(e);var I=()=>new O;const N=(e,t,n)=>r=>{const i=()=>{E(t=>n.add(e,t),g(String(r)),e,t,n)};m(i=>{S(t=>{v(i),n.replace(e,t)},g(String(r)),e,t,n)},r=>{var s;(s=r,O.sortIndexes(s.fragmentChildIndexes)).forEach(e=>{w(t=>{v(t),n.remove(e)},e,t,n)}),v(r),n.removeFragment(e),i()},i)(e,n)},K=(e,t,n,r,i)=>()=>{const s=e.elementSubscription;s&&i.add(s),E(e=>r.add(t,{...e,subscription:s}),e.dom,t,n,r)},j=(e,t,n,r)=>i=>{i.fragmentChildIndexes.reduce(F(r,!0),[]).forEach(t=>{w(n=>{i.key&&e[i.key]||v(n),r.remove(t)},t,n,r)}),i.key&&e[i.key]||v(i),r.removeFragment(t)},A=(e,t,n,r,i,s,o)=>()=>{const l=i.split(".").length;t.fragmentChildren.forEach(e=>{const t=e.index.split(".").slice(l).join("."),n=`${i}.${t}`;E(t=>{o.add(n,{...t,key:e.key,subscription:e.subscription}),o.has(e.index)&&o.remove(e.index)},e.element,n,s,o)}),r.fragmentChildKeys={...r.fragmentChildKeys,[e.key]:i},delete n[e.key]},M=(e,t,n,r,i,s,o)=>{E(s=>{o.add(i,{...s,key:e.key,subscription:t.child.subscription}),r.fragmentChildKeys={...r.fragmentChildKeys,[e.key]:i},delete n[e.key]},t.child.element,i,s,o)},L=(e,t)=>((e=>e.oldKeyElementMap&&Object.keys(e.oldKeyElementMap).length>0)(t)&&Object.values(t.oldKeyElementMap).forEach(e=>{e.fragmentChildren&&e.fragmentChildren.forEach(e=>v(e)),v(e.child)}),t.oldKeyElementMap=Object.keys(t.fragmentChildKeys).reduce((n,r)=>{const i=t.fragmentChildKeys[r],s=e.get(i)||e.getFragment(i),o=s.fragmentChildIndexes&&s.fragmentChildIndexes.reduce(F(e),[]);return n[r]={index:i,child:s,fragmentChildren:o},n},{}),t.oldKeyElementMap),T=(e,t,n,r,i)=>(s,o)=>{const l=e[s.key];if(l){if(l.index===o)return((e,t,n,r)=>{t.fragmentChildKeys={...t.fragmentChildKeys,[r]:n},delete e[r],console.log("Skip rendering element with key: ",r)})(e,t,o,s.key);l.child.element===d?((e,t,n,r,i,s,o)=>{m(()=>{w(e=>{o.remove(e.index),e.key&&n[e.key]||v(e)},i,s,o),A(e,t,n,r,i,s,o)()},l=>{j(n,i,s,o)(l),A(e,t,n,r,i,s,o)()},A(e,t,n,r,i,s,o))(i,o)})(s,l,e,t,o,n,r):((e,t,n,r,i,s,o)=>{m(l=>{S(s=>{l.key&&n[l.key]||v(l),o.replace(i,{...s,key:e.key,subscription:t.child.subscription}),r.fragmentChildKeys={...r.fragmentChildKeys,[e.key]:i},delete n[e.key]},t.child.element,i,s,o)},l=>{j(n,i,s,o)(l),M(e,t,n,r,i,s,o)},()=>M(e,t,n,r,i,s,o))(i,o)})(s,l,e,t,o,n,r),console.log("Move child with key: ",s.key)}else t.fragmentChildKeys={...t.fragmentChildKeys,[s.key]:o},console.log("Render child with key: ",s.key),i(s,o)};function R(e,n,r,i,s){return o=>{const l=r.getFragment(e),c=L(r,l);l.fragmentChildKeys={},((e,t,n,r,i,s)=>{const o=s.fragmentChildrenLength,l=r.children.length;if(o>l){const r=o-l;Array.from({length:r},(e,t)=>t+l).forEach(r=>{const s=`${e}.${r}`;n.has(s)?w(e=>{e.key&&i[e.key]||v(e),n.remove(e.index)},s,t,n):n.hasFragment(s)&&j(i,s,t,n)(n.getFragment(s))})}})(e,n,r,o,c,l),o.children.forEach(((e,n,r,i)=>(s,o)=>{const l=`${e}.${o}`;if(t.isObservable(s)){const e=s.subscribe(e=>{u(e)&&e.key?r(e,l):i(e,l)});n.add(e)}else u(s)&&s.key?r(s,l):i(s,l)})(e,i,T(c,l,n,r,s),s))}}const $=(e,t,n,r,i)=>s=>{m(((e,t,n,r,i,s)=>()=>{w(o=>(v(o),r.remove(o.index),r.createEmptyFragment(t),R(t,n,r,i,s)(e)),t,n,r)})(s,e,t,n,r,i),((e,t,n,r,i,s)=>()=>R(t,n,r,i,s)(e))(s,e,t,n,r,i),((e,t,n,r,i,s)=>()=>(r.createEmptyFragment(t),R(t,n,r,i,s)(e)))(s,e,t,n,r,i))(e,n)},D=(e,t,n,r,i)=>s=>(n.createEmptyFragment(e),R(e,t,n,r,i)(s)),B=(e,t)=>(t&&u(e)&&(e.key?e.key!==t&&(e.key=`${t}.${e.key}`):e.key=t),e);function P(e,n,r,i,s){return n=>{const r=(o=n,console.log("COMPONENT DEBUG: ",o),o._component((e=>{const t=e.props;return e.children&&(t.children=e.children),t})(o)));var o;console.log("COMPONENT CHILD DEBUG: ",r);const l=n.key||null;if(!t.isObservable(r))return s(B(r,l),e);{const t=r.subscribe(t=>s(B(t,l),e));i.add(t)}}}const _=(e,t,n,r)=>i=>{const s=W(i),o=K(s,e,t,n,r);m(((e,t,n,r,i)=>s=>{const o=e.elementSubscription;o&&i.add(o),S(e=>{v(s),r.add(t,{...e,subscription:o})},e.dom,t,n,r)})(s,e,t,n,r),((e,t,n,r,i)=>t=>{t.fragmentChildIndexes.reduce(F(i,!0),[]).forEach(e=>{w(t=>{v(t),i.remove(e)},e,r,i)}),v(t),i.removeFragment(n),e()})(o,0,e,t,n),o)(e,n)},G=(e,t,n)=>(r,i)=>Q(i,e,t,n)(r),q=(...e)=>{const[t,n,r,i]=e;return f(null,((e,t,n)=>r=>{E(t=>n.add(e,t),g(String(r)),e,t,n)})(...e),((...e)=>t=>D(...e)(k(t)))(t,n,r,i,G(n,r,i)),P(t,0,0,i,G(n,r,i)),D(t,n,r,i,G(n,r,i)),((e,t,n,r)=>i=>{const s=W(i);K(s,e,t,n,r)()})(...e))},Q=(...e)=>{const[t,n,r,i]=e;return f(()=>{},N(...e),((...e)=>t=>$(...e)(k(t)))(t,n,r,i,G(n,r,i)),P(t,0,0,i,G(n,r,i)),$(t,n,r,i,G(n,r,i)),_(...e))},U=(e,n)=>{const r=new t.Subscription,i=I();return e.forEach(((e,n,r)=>(i,s)=>{const o=String(s);if(t.isObservable(i)){const t=i.subscribe(Q(o,e,n,r));r.add(t)}else q(o,e,n,r)(i)})(n,i,r)),r};function W(e){const t=(n=e.type,function(e){return a.includes(e.type)}(e)?document.createElementNS("http://www.w3.org/2000/svg",n):document.createElement(n));var n;const r=C(e,t);if(e.children){const n=U(e.children,t);r.add(n)}return{dom:t,elementSubscription:r}}const z=e=>{const r=new t.BehaviorSubject(e),i=r.asObservable();return[i,e=>{s(e)?n.first()(i).subscribe(e):r.next(e)}]};e.createElement=function(e,t,n){return function(e,t,n,r,i){const s={type:e,props:t,children:n};r&&(s.key=r);i&&(s.ref=i);(function(e){return"function"==typeof e})(e)&&(s._component=e);return s}(e,t,n,t.key,t.ref)},e.createState=z,e.eventState=e=>{const r=new t.ReplaySubject(1);return[r.asObservable(),i=>s=>{const o=e?e(i?i(s):s):i?i(s):s;return t.pipe(n.tap(r.next),n.catchError(e=>(r.next(e),t.throwError(()=>e))))(o)}]},e.iQRvdStart=(e,n)=>r=>{console.log("Living");const i=c(n);if(!e||!i)throw new Error("Root RvdElement and Root Dom cannot be undefined or null");return function(e,n){console.log("rootChild");const r=new t.Subscription,i=I();return q("0",n,i,r)(e),r}(e,i)},e.useState=z,Object.defineProperty(e,"__esModule",{value:!0})}));
